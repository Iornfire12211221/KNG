__d((function(g,r,i,a,m,e,d){Object.defineProperty(e,"__esModule",{value:!0}),e.smartAI=e.SmartAISystem=void 0;var t=r(d[0]);class n{patterns=new Map;cache=new Map;constructor(){this.model=this.initializeModel()}static getInstance(){return n.instance||(n.instance=new n),n.instance}initializeModel(){return{version:'3.0.0',intelligence:0,accuracy:0,totalDecisions:0,correctDecisions:0,patterns:[],weights:{toxicity:.25,relevance:.3,quality:.2,context:.15,image:.1},thresholds:{approve:.8,reject:.2,moderate:.5},lastTraining:Date.now()}}async moderatePost(t){console.log('\ud83e\udde0 SMART AI v3.0.0 analyzing post:',t.type);try{const n=this.generateCacheKey(t),o=this.cache.get(n);if(o&&Date.now()-o.timestamp<3e5)return console.log('\ud83c\udfaf Cache hit for smart AI'),o.decision;const s=this.extractLearningData(t),c=await this.analyzeFactors(t,s),l=await this.applySmartPatterns(s),h=this.calculateFinalScore(c,l),y=this.makeSmartDecision(h,c,s);return this.cache.set(n,{decision:y,timestamp:Date.now()}),await this.recordDecision(t,y),console.log('\ud83e\udde0 SMART AI Decision:',{decision:y.decision,confidence:(100*y.confidence).toFixed(1)+'%',intelligence:this.model.intelligence}),y}catch(n){return console.error('\u274c Smart AI error:',n),this.getFallbackDecision(t)}}extractLearningData(t){const n=new Date,o=n.getHours(),s=n.getMonth()+1;return{timeOfDay:o>=6&&o<12?'morning':o>=12&&o<18?'day':o>=18&&o<22?'evening':'night',season:s>=3&&s<=5?'spring':s>=6&&s<=8?'summer':s>=9&&s<=11?'autumn':'winter',postType:t.type,hasPhoto:t.hasPhoto,descriptionLength:this.getDescriptionLengthCategory(t.description),keywords:this.extractKeywords(t.description)}}async analyzeFactors(t,n){const o={toxicity:await this.analyzeToxicity(t.description),relevance:await this.analyzeRelevance(t,n),quality:await this.analyzeQuality(t,n),context:await this.analyzeContext(t,n),image:await this.analyzeImage(t)};return console.log('\ud83d\udcca Factors analysis:',o),o}async analyzeToxicity(t){const n=t.toLowerCase();let o=0;return['\u0441\u043f\u0430\u043c','\u0440\u0435\u043a\u043b\u0430\u043c\u0430','\u043e\u0441\u043a\u043e\u0440\u0431\u043b\u0435\u043d\u0438\u0435','\u043c\u0430\u0442','\u0440\u0443\u0433\u0430\u0442\u0435\u043b\u044c\u0441\u0442\u0432\u043e'].forEach((t=>{n.includes(t)&&(o+=.3)})),t.length<10&&(o+=.2),t.length>500&&(o+=.1),Math.min(o,1)}async analyzeRelevance(t,n){const o=t.description.toLowerCase();let s=0;return['\u0434\u043f\u0441','\u0434\u0442\u043f','\u043a\u0430\u043c\u0435\u0440\u0430','\u0440\u0435\u043c\u043e\u043d\u0442','\u0434\u043e\u0440\u043e\u0433','\u043f\u0430\u0442\u0440\u0443\u043b\u044c','\u043f\u0440\u043e\u0431\u043a','\u0441\u0432\u0435\u0442\u043e\u0444\u043e\u0440','\u043e\u0431\u044a\u0435\u0437\u0434','\u0437\u043d\u0430\u043a','\u043c\u0430\u0448\u0438\u043d','\u0430\u0432\u0442\u043e','\u0442\u0440\u0430\u0441\u0441','\u0448\u043e\u0441\u0441\u0435'].forEach((t=>{o.includes(t)&&(s+=.1)})),t.hasPhoto&&(s+=.2),t.location&&'\u041d\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043d\u044b\u0439 \u0430\u0434\u0440\u0435\u0441'!==t.location&&(s+=.1),Math.min(s,1)}async analyzeQuality(t,n){let o=.5;t.description.length>=20&&t.description.length<=200&&(o+=.2);const s=t.description.toLowerCase();return['\u0441\u0435\u0439\u0447\u0430\u0441','\u0442\u043e\u043b\u044c\u043a\u043e \u0447\u0442\u043e','\u0432\u043d\u0438\u043c\u0430\u043d\u0438\u0435','\u043e\u0441\u0442\u043e\u0440\u043e\u0436\u043d\u043e','\u0441\u0440\u043e\u0447\u043d\u043e'].forEach((t=>{s.includes(t)&&(o+=.1)})),'day'!==n.timeOfDay&&'morning'!==n.timeOfDay||(o+=.1),Math.min(o,1)}async analyzeContext(t,n){let o=.5;const s={roadwork:['\u0440\u0435\u043c\u043e\u043d\u0442','\u0440\u0430\u0431\u043e\u0442\u0430','\u0442\u0435\u0445\u043d\u0438\u043a','\u0430\u0441\u0444\u0430\u043b\u044c\u0442','\u0434\u043e\u0440\u043e\u0436\u043d'],dps:['\u0434\u043f\u0441','\u043f\u043e\u043b\u0438\u0446','\u043f\u0430\u0442\u0440\u0443\u043b\u044c','\u043f\u043e\u0441\u0442','\u0440\u0430\u0434\u0430\u0440'],accident:['\u0434\u0442\u043f','\u0430\u0432\u0430\u0440\u0438\u044f','\u0441\u0442\u043e\u043b\u043a\u043d\u043e\u0432\u0435\u043d','\u043f\u043e\u0432\u0440\u0435\u0436\u0434\u0435\u043d'],camera:['\u043a\u0430\u043c\u0435\u0440\u0430','\u0444\u043e\u0442\u043e\u0444\u0438\u043a\u0441\u0430\u0446','\u0440\u0430\u0434\u0430\u0440','\u043a\u043e\u043d\u0442\u0440\u043e\u043b'],animals:['\u0436\u0438\u0432\u043e\u0442\u043d','\u043b\u043e\u0441','\u043a\u0430\u0431\u0430\u043d','\u0441\u043e\u0431\u0430\u043a','\u043a\u043e\u0448\u043a']}[t.type]||[],c=t.description.toLowerCase();return s.forEach((t=>{c.includes(t)&&(o+=.2)})),Math.min(o,1)}async analyzeImage(t){if(!t.hasPhoto||!t.photo)return.5;try{return.7}catch(t){return console.error('Image analysis error:',t),.5}}async applySmartPatterns(t){const n={},o=['time','type','photo','keyword','context'];for(const s of o){const o=this.getPatternKey(s,t),c=this.patterns.get(o);c&&c.samples>=5?n[s]=c.accuracy:n[s]=.5}return n}calculateFinalScore(t,n){let o=0,s=0;return Object.keys(t).forEach((c=>{const l=this.model.weights[c],h=t[c],y=n[c]||.5;o+=(.7*h+.3*y)*l,s+=l})),s>0?o/s:.5}makeSmartDecision(t,n,o){let s,c,l;t>=this.model.thresholds.approve?(s='APPROVED',c=Math.min(t,.95),l='\u0412\u044b\u0441\u043e\u043a\u043e\u0435 \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u043e \u0438 \u0440\u0435\u043b\u0435\u0432\u0430\u043d\u0442\u043d\u043e\u0441\u0442\u044c \u043a\u043e\u043d\u0442\u0435\u043d\u0442\u0430'):t<=this.model.thresholds.reject?(s='REJECTED',c=Math.max(1-t,.05),l='\u041d\u0438\u0437\u043a\u043e\u0435 \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u043e \u0438\u043b\u0438 \u043d\u0435\u0440\u0435\u043b\u0435\u0432\u0430\u043d\u0442\u043d\u044b\u0439 \u043a\u043e\u043d\u0442\u0435\u043d\u0442'):(s='FLAGGED',c=.5,l='\u0422\u0440\u0435\u0431\u0443\u0435\u0442 \u0440\u0443\u0447\u043d\u043e\u0439 \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0438 \u043c\u043e\u0434\u0435\u0440\u0430\u0442\u043e\u0440\u0430');return{decision:s,confidence:c,reasoning:l,factors:n,patterns:this.getRelevantPatterns(o),learningData:o}}async recordDecision(n,o){try{await t.prisma.aIModeration.create({data:{postId:n.id,content:n.description,imageUrl:n.photo,toxicityScore:o.factors.toxicity,relevanceScore:o.factors.relevance,severityScore:o.factors.quality,categoryScore:o.factors.context,detectedLanguage:'ru',keyPhrases:o.learningData.keywords,entities:[],decision:'APPROVED'===o.decision?'APPROVED':'REJECTED'===o.decision?'REJECTED':'PENDING',confidence:o.confidence,reasoning:o.reasoning,processedAt:new Date}}),this.model.totalDecisions++}catch(t){console.error('Error recording decision:',t)}}async learnFromModerator(n,o){try{console.log('\ud83e\udde0 Learning from moderator decision:',o);const s=await t.prisma.aIModeration.findFirst({where:{postId:n}});if(!s)return;const c=s.decision===o;c&&this.model.correctDecisions++,this.model.accuracy=this.model.correctDecisions/this.model.totalDecisions,this.model.intelligence=Math.min(100*this.model.accuracy,100),await this.updatePatterns(s,c),console.log('\ud83e\udde0 Learning completed. Intelligence:',this.model.intelligence.toFixed(1))}catch(t){console.error('Error learning from moderator:',t)}}async updatePatterns(t,n){}generateCacheKey(t){return`${t.type}_${t.hasPhoto}_${t.description.length}_${t.userId}`}getDescriptionLengthCategory(t){const n=t.length;return 0===n?'empty':n<20?'short':n<100?'medium':n<300?'long':'very_long'}extractKeywords(t){const n=[],o=t.toLowerCase();return['\u0434\u043f\u0441','\u0434\u0442\u043f','\u043a\u0430\u043c\u0435\u0440\u0430','\u0440\u0435\u043c\u043e\u043d\u0442','\u0434\u043e\u0440\u043e\u0433','\u043f\u0430\u0442\u0440\u0443\u043b\u044c'].forEach((t=>{o.includes(t)&&n.push(t)})),n}getPatternKey(t,n){switch(t){case'time':return`time_${n.timeOfDay}`;case'type':return`type_${n.postType}`;case'photo':return`photo_${n.hasPhoto}`;case'keyword':return`keyword_${n.keywords.join('_')}`;case'context':return`context_${n.timeOfDay}_${n.postType}`;default:return''}}getRelevantPatterns(t){const n=[];return t.timeOfDay&&n.push(`time:${t.timeOfDay}`),t.postType&&n.push(`type:${t.postType}`),t.hasPhoto&&n.push('has_photo'),t.keywords.length>0&&n.push(`keywords:${t.keywords.join(',')}`),n}getFallbackDecision(t){return{decision:'FLAGGED',confidence:.5,reasoning:'\u041e\u0448\u0438\u0431\u043a\u0430 \u0430\u043d\u0430\u043b\u0438\u0437\u0430, \u0442\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u0440\u0443\u0447\u043d\u0430\u044f \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0430',factors:{toxicity:.5,relevance:.5,quality:.5,context:.5,image:.5},patterns:[],learningData:this.extractLearningData(t)}}getModelStats(){return{version:this.model.version,intelligence:this.model.intelligence,accuracy:this.model.accuracy,totalDecisions:this.model.totalDecisions,correctDecisions:this.model.correctDecisions,patternsCount:this.patterns.size,lastTraining:this.model.lastTraining}}}e.SmartAISystem=n;e.smartAI=n.getInstance()}),2643,[2638]);